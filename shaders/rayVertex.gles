#version 300 es

uniform highp mat4 view;
uniform lowp vec4 palette[16];
uniform lowp ivec4 style[16];
uniform mediump mat4 handles[32];

in ivec4 xyzc;
out vec4 color;

void main(){
	int w=int(xyzc.w);
	color=palette[w&15];
	int scope=gl_InstanceID;
	mat4 model=handles[scope];
	vec4 v=vec4(xyzc.x,xyzc.y,xyzc.z,1.0);
	v=v*model;
	v=v*view;
	float zbias=0.0;
	float d=zbias+v.z;
	vec4 i=vec4(v.x,v.y,d,1.0);
	gl_Position=i;
}
